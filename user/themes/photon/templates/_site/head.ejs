<%
var page_title = get_page_title()
var page_description = page.excerpt ? page.excerpt : config.description
var page_date = page.date ? page.date : date_xml(Date.now())
var page_updated = page.updated ? page.updated : page_date
var page_image = config.url + url_for(config.logo)
-%>
<% if ( page.figure && page.figure !== undefined) { -%>
  <% if ( page.figure.image !== undefined) {
    page_image = url_for(page.permalink) + page.figure.image
  } %>
<% } %>
<head>
  <meta charset="utf-8">
  <title><%= page_title %></title>
  <meta name="description" content="<%= strip_html(page_description) %>">
  <meta name="author" content="<%= config.author %>">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <%# TODO: pull the css from the theme config file -%>

  <!-- css -->
  <% css('css/elements') %>
  <% css('css/photon') %>
  <% css('css/print') %>

<% if (theme.rss) { -%>
  <!-- rss -->
  <link rel="alternate" href="<%- url_for(theme.rss) %>" title="<%= config.title %>" type="application/atom+xml">
<% } -%>

<% if (config.favicon) { -%>
  <!-- favicon -->
  <link rel="icon" href="<%- url_for('images/' + config.favicon) %>">
<% } -%>
<%# TODO: code highlight font integration -%>
<% if (config.highlight.enable) { -%>
  <!-- highlight -->
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
<% } -%>

<!-- opengraph -->
<meta property="og:title" content="<%= page_title %>">
<meta property="og:description" content="<%= strip_html(page_description) %>">
<meta property="og:image" content="<%= page_image %>">

<meta property="og:url" content="<%= page.permalink ? page.permalink : config.url %>">
<meta name="twitter:card" content="<%= page_image %>">

<!-- Libraries -->
<!-- fancybox -->
<%- css('fancybox/jquery.fancybox.min') -%>
<!-- google -->
<%# TODO: google analytics -%>
<%#- partial('google-analytics') -%>
<% if (config.google_analytics) { -%>
  <meta name="google-site-verification" content="<%-  config.google_analytics %>" />
<% } -%>
<!-- highlight -->
<%- css('highlight/atom-one-dark') -%>
<%- js('highlight/highlight.pack') -%>
<script>hljs.initHighlightingOnLoad();</script>
<!-- greensock -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.3/TweenMax.min.js"></script>

<!-- JSON-ld -->
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "<%- config.url %><%- url_for(page.path) %>"
  },
  "headline": "<%- page_title %>",
  "image": [
    "<%- page_image %>"
   ],
  "datePublished": "<%- page_date %>",
  "dateModified": "<%- page_updated %>",
  "author": {
    "@type": "Person",
    "name": "phi"
  },
   "publisher": {
    "@type": "Organization",
    "name": "<%- config.title %>",
    "logo": {
      "@type": "ImageObject",
      "url": "<%- config.url %><%- url_for(config.logo) %>"
    }
  },
  "description": "<%- strip_html(page_description) %>"
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Restaurant",
  "@id": "<%- config.organization.id %>",
  "url": "<%- config.organization.url %>",
  "name": "<%- config.organization.name %>",
  "logo": {
    "@type": "ImageObject",
    "url": "<%- config.url %><%- url_for(config.organization.logo) %>"
  },
  "image": [
    "<%- config.url %><%- url_for(config.organization.image) %>"
   ],
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "<%- config.organization.address.streetAddress %>",
    "addressLocality": "<%- config.organization.address.addressLocality %>",
    "addressRegion": "<%- config.organization.address.addressRegion %>",
    "postalCode": "<%- config.organization.address.postalCode %>",
    "addressCountry": "<%- config.organization.address.addressCountry %>"
  },
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": <%- config.organization.geo.lat %>,
    "longitude": <%- config.organization.geo.long %>
  },
  "telephone": "<%- config.organization.telephone %>",
  "servesCuisine": "<%- config.organization.servesCuisine %>",
  "priceRange": "<%- config.organization.priceRange %>",
  "potentialAction": {
    "@type": "ReserveAction",
    "target": {
      "@type": "EntryPoint",
      "urlTemplate": "<%- config.organization.reservationURL %>",
      "inLanguage": "en-US",
      "actionPlatform": [
        "http://schema.org/DesktopWebPlatform",
        "http://schema.org/IOSPlatform",
        "http://schema.org/AndroidPlatform"
      ]
    },
    "result": {
      "@type": "FoodEstablishmentReservation",
      "name": "Reserve table"
    }
  },
  <%  var hours = config.organization.hours  -%>
  "openingHoursSpecification": [
      {
        "@type": "OpeningHoursSpecification",
        "dayOfWeek": "http://schema.org/Monday",
        "opens":  "<%- hours.Monday.opens %>",
        "closes":  "<%- hours.Monday.closes %>"
      },
      {
        "@type": "OpeningHoursSpecification",
        "dayOfWeek": "http://schema.org/Tuesday",
        "opens":  "<%- hours.Tuesday.opens %>",
        "closes":  "<%- hours.Tuesday.closes %>"
      },
      {
        "@type": "OpeningHoursSpecification",
        "dayOfWeek": "http://schema.org/Wednesday",
        "opens":  "<%- hours.Wednesday.opens %>",
        "closes":  "<%- hours.Wednesday.closes %>"
      },
      {
        "@type": "OpeningHoursSpecification",
        "dayOfWeek": "http://schema.org/Thursday",
        "opens":  "<%- hours.Thursday.opens %>",
        "closes":  "<%- hours.Thursday.closes %>"
      },
      {
        "@type": "OpeningHoursSpecification",
        "dayOfWeek": "http://schema.org/Friday",
        "opens":  "<%- hours.Friday.opens %>",
        "closes":  "<%- hours.Friday.closes %>"
      },
      {
        "@type": "OpeningHoursSpecification",
        "dayOfWeek": "http://schema.org/Saturday",
        "opens":  "<%- hours.Saturday.opens %>",
        "closes":  "<%- hours.Saturday.closes %>"
      },
      {
        "@type": "OpeningHoursSpecification",
        "dayOfWeek": "http://schema.org/Sunday",
        "opens":  "<%- hours.Sunday.opens %>",
        "closes":  "<%- hours.Sunday.closes %>"
      }
  ]
}
</script>

</head>
